//! stanz - v8.1.34 https://github.com/ofajs/stanz  (c) 2018-2025 YAO
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).stanz={})}(this,(function(e){"use strict";const t="https://ofajs.github.io/ofa-errors/errors",r={};if(globalThis.navigator&&navigator.language){let e=navigator.language.toLowerCase().split("-")[0];"zh"===e&&"zh-cn"!==navigator.language.toLowerCase()&&(e="zhft"),(async()=>{if("undefined"!=typeof localStorage){if(localStorage["ofa-errors"]){const e=JSON.parse(localStorage["ofa-errors"]);Object.assign(r,e)}const n=localStorage["ofa-errors-time"];if(!n||Date.now()>Number(n)+3e5){const n=await fetch(`${t}/${e}.json`).then((e=>e.json())).catch((()=>null));n?(localStorage["ofa-errors"]=JSON.stringify(n),localStorage["ofa-errors-time"]=Date.now()):n=await fetch(`${t}/en.json`).then((e=>e.json())).catch((e=>(console.error(e),null))),Object.assign(r,n)}}})()}let n=!1;globalThis.navigator&&(n=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"));const o=(e,t,r)=>{let o,a=s(e,t);return r?(n&&(a+=`\nCaused by: ${r.toString()}\n`,r.stack&&(a+=`  ${r.stack.replace(/\n/g,"\n    ")}`)),o=new Error(a,{cause:r})):o=new Error(a),o.code=e,o},s=(e,t)=>{if(!r[e])return`Error code: "${e}", please go to https://github.com/ofajs/ofa-errors to view the corresponding error information`;let n=r[e];if(t)for(let e in t)n=n.replace(new RegExp(`{${e}}`,"g"),t[e]);return n},a=()=>Math.random().toString(32).slice(2),i=Object.prototype.toString,c=e=>{const t=(r=e,i.call(r).toLowerCase().replace(/(\[object )|(])/g,""));var r;return"array"===t||"object"===t},l={value:null};"undefined"!=typeof document&&(document.currentScript?l.value=document.currentScript.attributes.hasOwnProperty("debug"):l.value=!0);const u="nexttick_thread_limit";let h,f=0;const g=new Set;function p(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,function(e){if(clearTimeout(h),h=setTimeout((()=>{f=0})),l.value)return void Promise.resolve().then((()=>{if(f++,f>1e5){const t=o(u);throw console.warn(t,"lastCall => ",e),t}e()}));const t=`t-${a()}`;g.add(t),Promise.resolve().then((()=>{if(f++,f>5e4){g.clear();const t=o(u);throw console.warn(t,"lastCall => ",e),t}g.has(t)&&(e(),g.delete(t))}))}((()=>{r=null;const t=n.slice();n=[],e.call(this,t)})))}}const{assign:d,freeze:y}=Object;class w{constructor(e){d(this,e),y(this)}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));const t=e.split(".");if(this.currentTarget===this.target&&this.name===t[0])return!0;const r=m(this,t).indexOf(this.target);if(r>-1){const e=t.slice(r+1);return!e.length||this.name===e[0]}return this.path.includes(this.currentTarget[e])}hasReplaced(e){if("set"!==this.type)return!1;const t=e.split(".");if(this.target===this.currentTarget&&this.name===t[0])return!0;const r=m(this,t).indexOf(this.target);if(r>-1){return t.slice(r+1)[0]===this.name}return!1}}const m=(e,t)=>{const r=[],n=t.slice();let o=e.currentTarget;for(;n.length;){const e=n.shift();o&&(o=o[e]),r.push(o)}return r};class b extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const v=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:a,args:i,path:c=[]})=>{if(c&&c.includes(t)){const e=o("circular_data");return void console.warn(e,{currentTarget:t,target:r,path:c})}let l={type:e,target:r,name:n,oldValue:a,value:s};if("array"===e&&(delete l.value,l.args=i),t._hasWatchs){const e=new w({currentTarget:t,...l,path:[...c]});t[$].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{v({currentTarget:e,...l,path:[t,...c]})}))};var _={watch(e){if(!(e instanceof Function))throw o("not_func",{name:"watch"});const t="w-"+a();return this[$].set(t,e),t},unwatch(e){return this[$].delete(e)},watchTick(e,t){if(!(e instanceof Function))throw o("not_func",{name:"watchTick"});return this.watch(p((t=>{(function(e){try{return Object.getPrototypeOf(e),!1}catch(e){return e instanceof TypeError}})(this)||(t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new b(t)))}),t||0))},refresh(e){const t={...e,type:"refresh",target:this,currentTarget:this};v(t)},watchUntil(e,t=3e4){return new Promise(((r,n)=>{let s,a;const i=this.watch(s=()=>{e()&&(clearTimeout(a),this.unwatch(i),r(this))});a=setTimeout((()=>{this.unwatch(i);const t=o("watchuntil_timeout");console.warn(t,e,this),n(t)}),t),s()}))}};const{defineProperties:O}=Object,S=({target:e,key:t,value:r,receiver:n,type:o,succeed:s})=>{const a=n[t];let i=r;if(D(i)){if(a===r)return!0;i._owner.push(n)}else if(c(r)){const o=Object.getOwnPropertyDescriptor(e,t);o&&!o.hasOwnProperty("value")||(i=new(e.__OriginStanz||I)(r,{owner:n}),i._owner.push(n))}const l=a===r;!l&&D(a)&&j(a,n);const u=s(i);return!l&&!e.__unupdate&&v({type:o||"set",target:n,currentTarget:n,name:t,value:r,oldValue:a}),u},j=(e,t)=>{if(D(e)){const r=e._owner.indexOf(t);if(r>-1)e._owner.splice(r,1);else{const r=o("error_no_owner");console.warn(r,{owner:t,mismatch:e}),console.error(r)}}},T={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):O(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return S({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(n){const s=o("failed_to_set_data",{key:t},n);throw console.warn(s,{target:e,value:r}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):S({target:e,key:t,value:void 0,receiver:e[N],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},x=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],k=Symbol("placeholder");const P={},E=Array.prototype;x.forEach((e=>{E[e]&&(P[e]=function(...t){const r=Array.from(this),n=E[e].apply(this[M],t),{deletedItems:o,addedItems:s}=function(e,t){const r=Array.from(t),n=Array.from(e),o=[],s=new Map,a=e.length;for(let t=0;t<a;t++){const n=e[t],s=r.indexOf(n);s>-1?r[s]=k:o.push(n)}const i=t.length;for(let e=0;e<i;e++){const r=t[e],o=n.indexOf(r);o>-1?n[o]=k:s.set(e,r)}return{deletedItems:o,addedItems:s}}(r,this);for(let[e,t]of s)D(t)?t._owner.push(this):c(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of o)j(e,this);return v({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),n===this[M]?this[N]:n})})),["concat","filter","slice","flatMap","map"].forEach((e=>{if("constructor"===e||x.includes(e))return;const t=Array.prototype[e];t instanceof Function&&(P[e]=function(...e){return t.call(Array.from(this),...e)})}));const{defineProperties:A,getOwnPropertyDescriptor:R,entries:z}=Object,M=Symbol("self"),N=Symbol("proxy"),$=Symbol("watchs"),C=Symbol("isxdata"),D=e=>e&&!!e[C];function J(e,t=T){let r,{proxy:n,revoke:o}=Proxy.revocable(this,t);return n._update=1,A(this,{xid:{value:e.xid||a()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[C]:{value:!0},[M]:{configurable:!0,get:()=>this},[N]:{configurable:!0,get:()=>n},[$]:{get:()=>r||(r=new Map)},_hasWatchs:{get:()=>!!r},_revoke:{value:o}}),Object.keys(e).forEach((t=>{const r=R(e,t);let{value:o,get:s,set:a}=r;s||a?A(this,{[t]:r}):n[t]=o})),n}class I extends Array{constructor(e,t){return super(),J.call(this,e)}revoke(){const e=this[M];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[$].clear(),z(this).forEach((([e,t])=>{D(t)&&(this[e]=null)})),e._owner.forEach((e=>{z(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[M],delete e[N],e._revoke()}toJSON(){let e={},t=!0,r=-1;Object.keys(this).forEach((n=>{let o=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),D(o)&&(o=o.toJSON()),e[n]=o})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return A(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return((e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const o=Object.getOwnPropertyDescriptor(t,n),{configurable:s,enumerable:a,writable:i,get:c,set:l,value:u}=o;"value"in o?e.hasOwnProperty(n)?e[n]=u:Object.defineProperty(e,n,{enumerable:a,configurable:s,writable:i,...r,value:u}):Object.defineProperty(e,n,{enumerable:a,configurable:s,...r,get:c,set:l})})),e))(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let n=0,s=t.length;n<s;n++)try{r=r[t[n]]}catch(r){const s=o("failed_to_get_data",{key:t.slice(0,n).join(".")},r);throw console.warn(s,{key:e,self:this}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let t=0,n=r.length;t<n;t++)try{s=s[r[t]]}catch(n){const s=o("failed_to_get_data",{key:r.slice(0,t).join(".")},n);throw console.warn(s,{key:e,self:this}),s}return s[n]=t}return this[e]=t}}I.prototype.extend({..._,...P},{enumerable:!1});const V=e=>new I(e);Object.assign(V,{is:D}),e.Stanz=I,e.default=V,e.stanz=V,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=stanz.min.js.map
